{"version":3,"file":"vue.js","sources":["../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/compiler/index.js","../src/init.js","../src/index.js"],"sourcesContent":["let oldArrayProtoMethods = Array.prototype\n\nexport let arrayMethods = Object.create(Array.prototype)\n\nlet methods = ['push', 'pop', 'shift', 'unshift', 'splice', 'reverse', 'sort']\n\n// AOP 切片编程\nmethods.forEach((method) => {\n  arrayMethods[method] = function (...args) {\n    let ob = this.__ob__\n    let result = oldArrayProtoMethods[method].call(this, ...args)\n    // 用户新增的数据也可能是对象格式，需要进行拦截观测\n    let inserted\n    switch (method) {\n      case 'push':\n      case 'unshift':\n        inserted = args\n        break\n      case 'splice':\n        inserted = args.slice(2)\n      default:\n        break\n    }\n\n    if (inserted) ob.observeArray(inserted)\n    return result\n  }\n})\n\n// arrayMethods.push()\n","import { arrayMethods } from './array.js'\n\nclass Observer {\n  // 对value重新定义\n  constructor(value) {\n    // 给响应式数据增加__ob__\n    value.__ob__ = this\n\n    Object.defineProperty(value,'__ob__',{\n        value: this,\n        enumerable: false, // 不可枚举\n        configurable:false,// 不能删除此属性\n    })\n    // value可能是对象，也可能是数组，分情况处理\n    if (Array.isArray(value)) {\n      // 观测数组：重写可以改变数组的方法，不使用defineProperty\n      Object.setPrototypeOf(value, arrayMethods)\n      // 如果数据中的每项元素也是一个对象，则观测它\n      this.observeArray(value)\n    } else {\n      this.walk(value)\n    }\n  }\n  // 将数组中的对象变成响应式的\n  observeArray(value) {\n    for (let i = 0; i < value.length; i++) {\n      observe(value[i])\n    }\n  }\n  walk(data) {\n    // 将对象中的每个属性,重新定义成响应式的\n    Object.keys(data).forEach((key) => {\n      defineReactive(data, key, data[key])\n    })\n  }\n}\n\n// 定义一个方法，调用defineProperty 来观测数据，可以复用该方法\nexport function defineReactive(data, key, value) {\n  // 如果value也是对象，递归观测对象\n  observe(value)\n  Object.defineProperty(data, key, {\n    get() {\n      return value\n    },\n    set(newValue) {\n      if (newValue === value) return\n      // 如果设置的值是个对象，将对象变成响应式\n      observe(newValue)\n      value = newValue\n    },\n  })\n}\n\n// 创建observe构造函数，实现数据观测\nexport function observe(data) {\n  // 只对对象进行观测，不是对象无法观测\n  if (typeof data !== 'object' || data === null) {\n    return\n  }\n  // 如果数据被观测过，直接返回\n  if(data.__ob__) return\n  \n  // 通过类实现对数据的观测，因为类方便扩展\n  return new Observer(data)\n}\n","import { observe } from './observer/index.js'\n\nexport function initState(vm) {\n  // 获取用户传入的options数据，数据类型可能是data,props,methods,computed,watch等\n  const opts = vm.$options\n  // 此处加入是data数据\n  if (opts.data) {\n    initData(vm)\n  }\n}\nfunction proxy(vm, source, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[source][key]\n    },\n    set(newValue) {\n      vm[source][key] = newValue\n    },\n  })\n}\nfunction initData(vm) {\n  // 劫持数据\n  let data = vm.$options.data\n  // 对data进行判断，如果是函数，获取返回值，否则直接获取数据\n  /* 设置vm._data 实现通过vm获取data */\n  data = vm._data = typeof data === 'function' ? data.call(vm) : data\n\n  // 将_data中的数据全部代理到vm上\n  for (let key in data) {\n    // 例如：取vm.name 实际上就是取vm._data.name\n    proxy(vm, '_data', key)\n  }\n  // 观测数据data,调用Object.defineProperty()\n  observe(data)\n}\n","\n\nexport function compileToFunctions(template) {\n\n}","import { initState } from './state.js'\nimport { compileToFunctions } from './compiler/index.js'\n\n// 初始化-》初始化状态-》初始化数据\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this\n    // 实例上有个属性$options，表示用户传入的所有属性\n    vm.$options = options\n    // 初始化状态\n    initState(vm)\n\n    // 将数据更新到dom\n    if (vm.$options.el) {\n      vm.$mount(vm.$options.el)\n    }\n  }\n\n  Vue.prototype.$mount = function (el) {\n    el = document.querySelector(el)\n\n    const vm = this\n    vm.$options.el = el\n\n    /**\n     * 1. 如果$options 传入的有render,不做任何处理，直接使用render，否则执行2；\n     * 2. 如果没有render，判断是否有template，有则将template转换render,否则执行3；\n     * 3. 没有render和template，就找外部模版，获取一个template模版，最终转换成render函数；\n     * \n    */\n\n    if (!vm.$options.render) {\n      let template = vm.$options.template\n      // 没有template\n      if (!template && el) {\n        template = el.outerHTML // 如果浏览器不兼容，考虑创建一个div标签插入到页面\n      }\n      // 将template 转换成render()函数\n      const render = compileToFunctions(template)\n\n      // 将生成的render函数绑定到$options上\n      vm.$options.render = render\n\n    }\n  }\n}\n\n\n","\nimport { initMixin } from './init.js'\n\n// 创建Vue构造函数\nfunction Vue(options) {\n  // 当 new Vue() 时，会执行_init(),进行初始化操作\n  this._init(options)\n}\n\n// 扩展初始化方法\ninitMixin(Vue)\n\nexport default Vue\n"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","ob","__ob__","args","result","call","inserted","slice","observeArray","Observer","value","defineProperty","enumerable","configurable","isArray","setPrototypeOf","walk","i","length","observe","data","keys","key","defineReactive","get","set","newValue","initState","vm","opts","$options","initData","proxy","source","_data","compileToFunctions","template","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","outerHTML"],"mappings":"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"}