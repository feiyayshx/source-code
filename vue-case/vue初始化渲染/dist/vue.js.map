{"version":3,"file":"vue.js","sources":["../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/compiler/parse.js","../src/compiler/generate.js","../src/compiler/index.js","../src/observer/watcher.js","../src/vdom/patch.js","../src/lifecycle.js","../src/init.js","../src/vdom/index.js","../src/render.js","../src/index.js"],"sourcesContent":["let oldArrayProtoMethods = Array.prototype\n\n/* 创建一个新对象，新对象的原型对象指向参数对象Array.prototype */\nexport let arrayMethods = Object.create(Array.prototype)\n\nlet methods = ['push', 'pop', 'shift', 'unshift', 'splice', 'reverse', 'sort']\n\n// AOP 切片编程\nmethods.forEach((method) => {\n  // 给新对象添加数组方法(这些方法都可以改变原始数组)\n  arrayMethods[method] = function (...args) {\n    let ob = this.__ob__\n\n    let result = oldArrayProtoMethods[method].call(this, ...args)\n    // 用户新增的数据也可能是对象格式，需要进行拦截观测\n    let inserted\n    switch (method) {\n      case 'push':\n      case 'unshift':\n        inserted = args\n        break\n      case 'splice':\n        inserted = args.slice(2)\n      default:\n        break\n    }\n\n    if (inserted) ob.observeArray(inserted)\n\n    return result\n  }\n})\n\n// arrayMethods.push()\n","import { arrayMethods } from './array.js'\n\nclass Observer {\n  // 对value重新定义\n  constructor(value) {\n    // 给响应式数据增加__ob__\n    value.__ob__ = this\n\n    Object.defineProperty(value,'__ob__',{\n        value: this,\n        enumerable: false, // 不可枚举\n        configurable:false,// 不能删除此属性\n    })\n    // value可能是对象，也可能是数组，分情况处理\n    if (Array.isArray(value)) {\n      // 观测数组：重写可以改变数组的方法，不使用defineProperty\n      Object.setPrototypeOf(value, arrayMethods)\n      // 如果数据中的每项元素也是一个对象，则观测它\n      this.observeArray(value)\n    } else {\n      this.walk(value)\n    }\n  }\n  // 将数组中的对象变成响应式的\n  observeArray(value) {\n    for (let i = 0; i < value.length; i++) {\n      observe(value[i])\n    }\n  }\n  walk(data) {\n    // 将对象中的每个属性,重新定义成响应式的\n    Object.keys(data).forEach((key) => {\n      defineReactive(data, key, data[key])\n    })\n  }\n}\n\n// 定义一个方法，调用defineProperty 来观测数据，可以复用该方法\nexport function defineReactive(data, key, value) {\n  // 如果value也是对象，递归观测对象\n  observe(value)\n  Object.defineProperty(data, key, {\n    get() {\n      return value\n    },\n    set(newValue) {\n      if (newValue === value) return\n      // 如果设置的值是个对象，将对象变成响应式\n      observe(newValue)\n      value = newValue\n    },\n  })\n}\n\n// 创建observe构造函数，实现数据观测\nexport function observe(data) {\n  // 只对对象进行观测，不是对象无法观测\n  if (typeof data !== 'object' || data === null) {\n    return\n  }\n  // 如果数据被观测过，直接返回\n  if(data.__ob__) return\n  \n  // 通过类实现对数据的观测，因为类方便扩展\n  return new Observer(data)\n}\n","import { observe } from './observer/index.js'\n\nexport function initState(vm) {\n  // 获取用户传入的options数据，数据类型可能是data,props,methods,computed,watch等\n  const opts = vm.$options\n  // 此处加入是data数据\n  if (opts.data) {\n    initData(vm)\n  }\n}\nfunction proxy(vm, source, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[source][key]\n    },\n    set(newValue) {\n      vm[source][key] = newValue\n    },\n  })\n}\nfunction initData(vm) {\n  // 劫持数据\n  let data = vm.$options.data\n  // 对data进行判断，如果是函数，获取返回值，否则直接获取数据\n  /* 设置vm._data 实现通过vm获取data */\n  data = vm._data = typeof data === 'function' ? data.call(vm) : data\n\n  // 将_data中的数据全部代理到vm上\n  for (let key in data) {\n    // 例如：取vm.name 实际上就是取vm._data.name\n    proxy(vm, '_data', key)\n  }\n  // 观测数据data,调用Object.defineProperty()\n  observe(data)\n}\n","const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; // aa-aa \nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; //aa:aa\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 可以匹配到标签名  [1]\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); //[0] 标签的结束名字\n//    style=\"xxx\"   style='xxx'  style=xxx\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\nconst startTagClose = /^\\s*(\\/?)>/;\n\nexport function parseHTML(html) {\n  let root = null;\n  let currentParent;\n  let stack = []\n\n  while (html) {\n    let textEnd = html.indexOf('<');\n    if (textEnd == 0) {\n      let startTagMatch = parseStartTag();\n      console.log(startTagMatch, 'startTagMatch') // {tagName:\"div\",attrs:[{name:'id',value:'app'},...]}\n      if (startTagMatch) { // 开始标签存在,生成ast语法树\n        start(startTagMatch.tagName, startTagMatch.attrs)\n        continue;\n      }\n      // 结束标签 \n      let endTagMatch = html.match(endTag);\n\n      if (endTagMatch) {\n        advance(endTagMatch[0].length);\n        end(endTagMatch[1]);\n        continue;\n      }\n    }\n    let text;\n    if (textEnd > 0) { // 开始解析文本\n      text = html.substring(0, textEnd)\n    }\n    if (text) {\n      advance(text.length);\n      chars(text);\n    }\n  }\n\n  /**\n * @return {Object}\n * @desc 匹配开始标签，返回标签名及其属性集合\n */\n  function parseStartTag() {\n    // ['<div','div',...]\n    const start = html.match(startTagOpen);\n    if (start) {\n      let match = {\n        tagName: start[1],\n        attrs: []\n      };\n      // 删除匹配过的标签\n      advance(start[0].length); // 获取元素 \n      // 查找属性\n      let end, attr;\n      //不是开头标签结尾就一直解析\n      while (!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\n        advance(attr[0].length); // a=1 a=\"1\" a='1'\n        match.attrs.push({ name: attr[1], value: attr[3] || attr[4] || attr[5] || true });\n      }\n      if (end) {\n        advance(end[0].length);\n        return match\n      }\n    }\n  }\n\n  function advance(n) {\n    html = html.substring(n)\n  }\n\n  // 根据开始标签 结束标签 文本内容 生成一个ast语法树\n  function start(tagName, attrs) { // [div]\n    let element = createASTElement(tagName, attrs);\n    if (!root) {\n      root = element;\n    }\n    currentParent = element // div>span>a   div  span\n    stack.push(element)\n  }\n\n  function createASTElement(tag, attrs) { // vue3里面支持多个根元素 (外层加了一个空元素) vue2中只有一个根节点\n    return {\n      tag,\n      type: 1,\n      children: [],\n      attrs,\n      parent: null\n    }\n  }\n  function end(tagName) {\n    let element = stack.pop();\n    currentParent = stack[stack.length - 1];\n    if (currentParent) {\n      element.parent = currentParent;\n      currentParent.children.push(element)\n    }\n  }\n\n  function chars(text) {\n    text = text.replace(/\\s/g, '');\n    if (text) {\n      currentParent.children.push({\n        type: 3,\n        text\n      })\n    }\n  }\n\n\n  return root\n}","const defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g\n\nfunction genProps(attrs) {\n  let str = '';\n  for (let i = 0; i < attrs.length; i++) {\n      let attr = attrs[i]; // name,value\n      if (attr.name === 'style') {\n          let obj = {};\n          attr.value.split(';').forEach(item => {\n              let [key, value] = item.split(':');\n              obj[key] = value\n          });\n          attr.value = obj; // {style:{color:red}}\n      }\n      str += `${attr.name}:${JSON.stringify(attr.value)},` // {a:'aaa',a:1,b:2,}\n  }\n  return `{${str.slice(0,-1)}}`;\n}\n\nfunction genChildren(el) {\n  const children  = el.children;\n  if(children){\n      return children.map(child=>gen(child)).join(',')\n  }\n}\n\nfunction gen(node){ // 区分是元素 还是文本\n  if(node.type == 1){\n      return generate(node);\n  }else{\n      //文本 逻辑不能用 _c来处理\n      // 有{{}} 普通文本  混合文本 {{aa}} aaa {{bbb}} ccc\n      let text =  node.text;\n      if(defaultTagRE.test(text)){ // _v(_s(name) + 'aa' + _s(age) + '哈哈'）\n          let tokens = [];\n          let match ;\n          let index = 0;\n          let lastIndex = defaultTagRE.lastIndex = 0;\n          while(match = defaultTagRE.exec(text)){ // aa {{ age }} haha \n              index = match.index;\n              if(index >lastIndex){\n                  tokens.push(JSON.stringify(text.slice(lastIndex,index)));\n              }\n              tokens.push(`_s(${match[1].trim()})`);\n              lastIndex = index + match[0].length;\n          }\n          if(lastIndex < text.length){\n              tokens.push(JSON.stringify(text.slice(lastIndex)))\n          }\n          return  `_v(${tokens.join('+')})`\n\n          // 是带有{{}}\n      }else{\n          return `_v(${JSON.stringify(text)})`\n      }\n  }\n}\n\nexport function generate(el) {\n  // console.log(el); // 转换成render代码\n  let children = genChildren(el);\n  let code = `_c('${el.tag}',${\n      el.attrs.length? genProps(el.attrs):'undefined'\n  } ${\n      children? (',' + children) : ''\n  })`;\n  // => js代码 html=> js代码  字符串拼接\n  return code;\n}\n\n/* \n将模版\n<div id=\"app\" a=1 b=2>\n    <span style\"=color:red\">{{name}} <a>hello</a></span>\n</div> \n编译成下面的代码：\n _c(\n    'div',{id:'app',a:1,b:2}\n    ,_c(\n        'span',\n        {style:{color:'red'}}\n        ,_s(_v(name)),\n        _c(a,undefined,_v('hello'))\n        )\n)\n*/\n","\nimport { parseHTML } from './parse'\nimport { generate } from './generate'\n\nexport function compileToFunctions(template) {\n  // 根据模版生成ast语法树\n  let ast = parseHTML(template)\n\n  // 根据ast 生成code代码\n  let code = generate(ast)\n\n  // 生成render 字符串\n  let render = `with(this){ return ${code}}`\n\n  // 将render字符串转为render函数\n\n  let fn = new Function(render)\n\n  return fn\n\n}","\nlet id = 0;\nclass Watcher {\n  constructor(vm, fn, cb, options) {\n    this.vm = vm;\n    this.fn = fn;\n    this.cb = cb;\n    this.options = options\n    this.id = id++\n    this.fn()\n  }\n}\n\nexport default Watcher","\nexport function patch() {}","import Watcher from './observer/watcher'\nimport { patch } from './vdom/patch'\nexport function lifecycleMixin(Vue) {\n  Vue.prototype._update = function (vnode) {\n    const vm = this\n    // 首次渲染，需要用虚拟节点来更新真实的dom元素\n    vm.$el = patch(vm.$options.$el, vnode)\n  }\n}\n\nexport function mountComponent(vm, el) {\n\n  // 更新组件\n  let updateComponent = () => {\n    // 传入虚拟节点\n    vm._update(vm._render())\n  }\n\n  // vue 通过渲染Watcher 进行渲染,每个组件都有一个渲染Watcher\n  new Watcher(vm, updateComponent, () => { }, true)\n}","import { initState } from './state.js'\nimport { compileToFunctions } from './compiler/index.js'\nimport { mountComponent } from './lifecycle.js'\n// 初始化-》初始化状态-》初始化数据\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this\n    // 实例上有个属性$options，表示用户传入的所有属性\n    vm.$options = options\n    // 初始化状态\n    initState(vm)\n\n    // 将数据更新到dom\n    if (vm.$options.el) {\n      vm.$mount(vm.$options.el)\n    }\n  }\n\n  Vue.prototype.$mount = function (el) {\n    el = document.querySelector(el)\n\n    const vm = this\n    vm.$options.el = el\n\n    /**\n     * 1. 如果$options 传入的有render,不做任何处理，直接使用render，否则执行2；\n     * 2. 如果没有render，判断是否有template，有则将template转换render,否则执行3；\n     * 3. 没有render和template，就找外部模版，获取一个template模版，最终转换成render函数；\n     * \n    */\n\n    if (!vm.$options.render) {\n      let template = vm.$options.template\n      // 没有template\n      if (!template && el) {\n        template = el.outerHTML // 如果浏览器不兼容，考虑创建一个div标签插入到页面\n      }\n      // 将template 转换成render()函数\n      const render = compileToFunctions(template)\n\n      // 将生成的render函数绑定到$options上\n      vm.$options.render = render\n\n    }\n\n    mountComponent(vm, el)\n\n  }\n}\n\n\n","\nexport function createElement(vm, tag, data = {}, ...children) {\n  return vnode(vm, tag, data, data.key, children, undefined)\n}\n\nexport function createTextVnode(vm, text) {\n  return vnode(vm, undefined, undefined, undefined, undefined, text)\n}\n\nfunction vnode(vm, tag, data, key, children, text) {\n  return { vm, tag, data, key, children, text }\n}","import {createElement,createTextVnode} from './vdom/index.js'\n\nexport function renderMixin(Vue) {\n  // 创建元素的虚拟节点\n  Vue.prototype._c = function(...args) {\n    return createElement(this,...args)\n  }\n\n  // 创建文本的虚拟节点\n  Vue.prototype._v = function(text) {\n    return createTextVnode(text)\n  }\n\n  // 转化为字符串\n  Vue.prototype._s = function(val) {\n    return val == null ? '' : (typeof val == 'object') ? JSON.stringify(val) : val\n  }\n\n  Vue.prototype._render = function() {\n    const vm = this\n    // 获取编译后的render函数\n    let render = vm.$options.render\n\n    // 调用render函数，生成虚拟节点,调用时会将变量赋值\n    let vnode = render.call(vm)\n\n    return vnode\n\n  }\n}","\nimport { initMixin } from './init.js'\nimport { lifecycleMixin } from './lifecycle.js'\nimport { renderMixin } from './render.js'\n\n// 创建Vue构造函数\nfunction Vue(options) {\n  // 当 new Vue() 时，会执行_init(),进行初始化操作\n  this._init(options)\n}\n\n// 扩展初始化方法\ninitMixin(Vue)\n\n// 扩展_update() 方法\nlifecycleMixin(Vue)\n\n// 扩展_render() 方法\nrenderMixin(Vue)\n\nexport default Vue\n"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","ob","__ob__","args","result","call","inserted","slice","observeArray","Observer","value","defineProperty","enumerable","configurable","isArray","setPrototypeOf","walk","i","length","observe","data","keys","key","defineReactive","get","set","newValue","initState","vm","opts","$options","initData","proxy","source","_data","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parseHTML","html","root","currentParent","stack","textEnd","indexOf","startTagMatch","parseStartTag","console","log","start","tagName","attrs","endTagMatch","match","advance","end","text","substring","chars","attr","push","name","n","element","createASTElement","tag","type","children","parent","pop","replace","defaultTagRE","genProps","str","obj","split","item","JSON","stringify","genChildren","el","map","child","gen","join","node","generate","test","tokens","index","lastIndex","exec","trim","code","compileToFunctions","template","ast","render","fn","Function","id","Watcher","cb","options","patch","lifecycleMixin","Vue","_update","vnode","$el","mountComponent","updateComponent","_render","initMixin","_init","$mount","document","querySelector","outerHTML","createElement","undefined","createTextVnode","renderMixin","_c","_v","_s","val"],"mappings":"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"}